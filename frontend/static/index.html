<html>
  <head>
    <title>FastAPI Message Interface</title>
  </head>
  <body>
    <h1>FastAPI Message Interface</h1>
    <input type="text" id="inputBox" placeholder="Enter text here">
    <br><br>
    <button id="getButton">Get</button>
    <button id="insertButton">Insert</button>
    <br><br>
    <div id="getOutput">
      <h3>Best Scoring Document:</h3>
      <pre id="bestDoc"></pre>
    </div>
    <div id="insertOutput">
      <h3>Insert Status:</h3>
      <pre id="status"></pre>
    </div>

    <script>
      // Remove this line or change to empty string
      // const BACKEND_URL = "http://localhost:9567";
      
      // "Get" Button: Use the proxy route instead
      document.getElementById('getButton').addEventListener('click', function(){
        fetch('/get')  // Use the proxy route defined in frontend/main.py
          .then(response => response.json())
          .then(data => {
            const messages = data["messages"];
            if (!messages || Object.keys(messages).length === 0) {
              document.getElementById('bestDoc').innerText = 'No messages available';
              return;
            }
            const bestId = Math.max(...Object.keys(messages).map(Number));
            const bestMsg = messages[bestId];
            document.getElementById('bestDoc').innerText = JSON.stringify(bestMsg, null, 2);
          })
          .catch(err => {
            document.getElementById('bestDoc').innerText = 'Error: ' + err;
          });
      });

      // "Insert" Button: Use the proxy route instead
      document.getElementById('insertButton').addEventListener('click', function(){
        const inputText = document.getElementById('inputBox').value;
        if (!inputText) {
          document.getElementById('status').innerText = 'Please enter some text.';
          return;
        }
        const largeDoc = inputText.repeat(20);
        fetch(`/insert/${encodeURIComponent(largeDoc)}`, {  // Use the proxy route
          method: 'POST'
        })
          .then(response => response.json())
          .then(data => {
            document.getElementById('status').innerText = JSON.stringify(data, null, 2);
          })
          .catch(err => {
            document.getElementById('status').innerText = 'Error: ' + err;
          });
      });
    </script>
  </body>
</html>
